package server;

import java.util.Iterator;
import java.util.Vector;

public class Effects {
	private Vector<effects.PlayerEffect> PlayerEffects;
	private Vector<effects.BallEffect> BallEffects;
	
	Effects(){
		PlayerEffects = new Vector<effects.PlayerEffect>();
		BallEffects = new Vector<effects.BallEffect>();
	}
	
	
	public void update(long deltaTime)
	{
		int size;
		size = PlayerEffects.size();
		for (Iterator<effects.PlayerEffect> pe = PlayerEffects.iterator(); pe.hasNext();)
		{
			effects.PlayerEffect e = pe.next();
			if (e.update(deltaTime))
				pe.remove();
		}
	
		for (Iterator<effects.BallEffect> be = BallEffects.iterator(); be.hasNext();)
		{
			effects.BallEffect e = be.next();
			if (e.update(deltaTime))
				be.remove();
		}
//		size = BallEffects.size();
//		for (int i = 0; i < size; i++)
//		{
//			if (BallEffects.get(i).update(deltaTime))
//				BallEffects.remove(BallEffects.get(i));
//		}
	}
	
	
	
	public void add(Effect effect)
	{
		switch(effect.For)
		{
		case BALL:
			addBall((effects.BallEffect) effect);
			break;
		case PLAYER:
			addPlayer((effects.PlayerEffect) effect);
			break;
		default:
			break;
		
		}
	}
	
	
	private void addPlayer(effects.PlayerEffect effectToAdd)
	{
		int size = PlayerEffects.size();
		effects.PlayerEffect effect;
		for (int i = 0; i < size; i++)
		{
			effect = PlayerEffects.get(i);
			if(effect.isForSameObject(effectToAdd))
			{
				effect.end();
				BallEffects.remove(i);
				break;
			}
		}
		
		effectToAdd.startEffect();
		PlayerEffects.add(effectToAdd);
	}
	
	private void addBall(effects.BallEffect effectToAdd)
	{
		int size = BallEffects.size();
		effects.BallEffect effect;
		for (int i = 0; i < size; i++)
		{
			effect = BallEffects.get(i);
			if(effect.isForSameObject(effectToAdd))
			{
				effect.end();
				BallEffects.remove(i);
				break;
			}
		}
		
		effectToAdd.startEffect();
		BallEffects.add(effectToAdd);
	}
}
